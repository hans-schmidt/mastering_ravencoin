<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta content="text/html; charset=windows-1252"
      http-equiv="content-type">
    <title>Supporting_HTLCs_for_Ravencoin_Assets_Without_a_Fork</title>
    <meta content="Hans Schmidt" name="author">
    <meta content="Supporting_HTLCs_for_Ravencoin_Assets_Without_a_Fork"
      name="description">
    <style type="text/css">

body{margin:0; padding-left: 50px; padding-right: 50px; font-family: verdana; font-size: 150%;}

p{padding:100px; height:20px; color:#4e4e4e; font-size:30px;}

a:link{color:#000066;}

a:visited{color:#6666ff;}

a:hover{color:#000000; text-decoration:underline;}

#spiral_note{margin:0; background-image:url(../images/spiral_note.png); background-repeat: repeat-y;}

div{margin-top:20px; margin-bottom:20px !important;}
  </style>
  </head>
  <body>
    <div id="spiral_note">
      <div style="padding-left: 126px;">
        <div style="background-image: url(../images/nospiral_note.png);
          background-repeat: repeat;">
          <div style="padding-right: 50px; padding-top: 10px;
            padding-bottom: 20px;"><br>
            <table width="100%" cellspacing="2" cellpadding="2"
              border="0">
              <tbody>
                <tr>
                  <td valign="top" width="33%">Hans Schmidt :&nbsp; Jan
                    29th 2021 <br>
                  </td>
                  <td valign="top" align="center"><br>
                  </td>
                  <td valign="top" width="33%" align="right"><a
                      href="mailto:hans_schm1dt@protonmail.com">hans_schm1dt@protonmail.com</a></td>
                </tr>
              </tbody>
            </table>
            <br>
            <br>
            <div align="center">
              <big><big>Supporting HTLCs for Ravencoin Assets Without a
                  Fork</big></big> <br>
              <i><b>*How to be Atomic*</b></i><br>
            </div>
            <br>
            This document describes a proposed method for supporting
            "Hash Time Lock Contracts" (HTLCs) for Ravencoin assets
            using the existing raven-qt v4.3.2.1.<br>
            <br>
            The purpose of this publication is to solicit feedback in
            case anyone sees a reason why this proposal will not
            function as intended.<br>
            <br>
            <br>
            <b>The Problem Statement:</b><br>
            <br>
            Ravencoin community members have expressed a desire for
            Ravencoin assets to be tradeable on AtomixDEX, a popular
            "Distributed Exchange" platform which is part of the Komodo
            blockchain project. The desired functionality is to be able
            to conveniently and safely trade assets on the Ravencoin
            blockchain in exchange for cryptocurrencies and assets on
            other blockchains.<br>
            <br>
            AtomicDEX is built using HTLCs to support UTXO-base
            blockchains (such as Ravencoin). Standard HTLC
            implementations require the UTXO transactions to use
            Pay-to-Script-Hash (P2SH) ouputs containing the tokens or
            assets being swapped. But the Ravencoin code is written to
            allow asset operations only on using the simpler
            Pay-to-Public-Key-Hash (P2PKH) outputs format. <br>
            <br>
            So it appears that Ravencoin consensus code changes (and a
            hardfork) are needed in order to make HTLCs possible for
            Ravencoin assets if standard HTLC implementation schemes are
            used.<br>
            <br>
            <blockquote><i>Sidebar: Note that the inability of Ravencoin
                to support P2SH format outputs for assets also makes
                Multisig Ravencoin assets currently impossible. This
                document and the enclosed proposal does not apply to or
                fix Multisig functionality of Ravencoin assets.</i><br>
            </blockquote>
            <br>
            <b>Some Background on HTLCs</b><br>
            <br>
            In any market trade, two parties deliver something to each
            other and the two halves of the transaction must be
            "Atomic"- either both parties receive the item from the
            other party, or neither of them do and the trade is
            cancelled. The established method for achieveing this
            "Atomic Trade" functionality between two parties on
            different UTXO-based blockchains is the "Hash Time Lock
            Contract". Non-UTXO blockchains such as Ethereum use "Smart
            Contracts" on their side of the exchange.<br>
            <br>
            AtomicDEX is built using HTLCs to support UTXO-base
            blockchains (such as Ravencoin). HTLCs are built using two
            interlocked transactions (which is what makes the exchange
            atomic). Standard HTLC implementations require the UTXO
            transactions to use Pay-to-Script-Hash (P2SH) ouputs
            containing the tokens or assets being swapped. The purpose
            of the P2SH format is to handle a secret which is generated
            by one party and then revealed to the other party. This
            secret is what interlocks the two transactions which are on
            different blockchains.<br>
            <br>
            A good simplified overview of Atomic Swaps, HTLCs, and why
            they require P2SH is available from Komodo at: <a
              href="https://blog.komodoplatform.com/en/atomic-swaps">https://blog.komodoplatform.com/en/atomic-swaps</a><br>
            <br>
            But as stated earlier, the Ravencoin code is written to
            allow asset operations only on outputs using the simpler
            P2PKH output format. RVN-only addresses, on the other hand,
            can support either P2PKH or P2SH output format. This implies
            that HTLCs (and therefore Atomic Swaps) can be done on RVN
            outputs but not on Ravencoin asset outputs. <br>
            <br>
            <br>
            <b>Some Background on Ravencoin On-Chain Asset Transfers</b><br>
            <br>
            Standard bitcoin transactions actually exhibit a simplistic
            form of "Atomicity". When you pay bitcoins from one address
            to another, you don't have to worry that the bitcoins could
            be deducted from the source address and then just disappear
            without arriving at the destination address. You can be
            certain that either the debit and the credit will both
            happen, or neither of them will. There is no such thing as
            "half a transaction" being executed. This is a consequence
            of the UTXO architecture and also a consequence of the
            transaction signing process. When the input of a transaction
            is signed, it signs the entire transaction,not just a
            portion of it (within the limits of transaction
            malleability- but that's a different story). When there are
            multiple inputs, each of the inputs requires a signature of
            the entire transaction. Either all the inputs and outputs
            happen, or none of them do.<br>
            <br>
            The Ravencoin design inherits this attribute of built-in
            transaction atomicity from bitcoin and extends it to cover
            assets. When you create an asset using a Ravencoin
            transaction, you pay RVN to a burn address and receive the
            asset at an address. But you never have to worry that the
            RVN will be burned without the asset being created.
            Likewise, when you transfer an asset from one address to
            another, you are certain that the debits and credits will
            both happen or neither of them will.<br>
            <br>
            In the transactions described thus far, you are the sole
            person who needs to sign the transaction because all of the
            inputs are yours. But you could create a Ravencoin asset
            sale transaction in which RVN come from one party and the
            assets from another, and each of these parties will needs to
            sign the transaction. Asset swaps could be done in a similar
            way. In these cases, the sale or swap is taking place within
            a single transaction. That means that it is inherently
            atomic and fast (determined by the one minute block rate)
            and needs no HTLC (which can take much longer).<br>
            <br>
            <br>
            <b>A Simple Solution<br>
              <br>
            </b>A Ravencoin asset transfer transaction must always
            include the payment of a transaction fee in order to get
            miners to include the transaction in a block. So the
            transaction will have at least two inputs (the source of RVN
            and the source of the asset), and at least two outputs (the
            RVN change and the destination of the assets). A standard
            HTLC transaction would dictate that the RVN change output be
            a simple P2PKH output, and the asset output should use the
            P2SH format to implement the exchange of the secret which
            underlies the HTLC.<br>
            <br>
            But transactions are all-or-none. So if we instead
            implemented the RVN change output as PS2H and the asset
            output as P2PKH format (which is the only format it
            supports), the end result is the same. It seems
            counter-intuitive that the secret exchange process of the
            HTLC be tied to the low-value RVN transaction fee payment
            rather than the high-value asset transfer. But the end
            result is the same since the portions of the transaction are
            inseparable.<br>
            <br>
            <b>Please let me know if you have reason to believe that
              this will not function as intended.</b><br>
            <b><br>
            </b>
            <div align="center">Copyright 2021 by Hans Schmidt<br>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
